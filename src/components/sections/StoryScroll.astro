---
import TheEngine from '../TheEngine.astro';
import '../../styles/story.css';
---

<section id="story-scroll-root" class="story-root relative overflow-hidden text-light">
  <div class="pointer-events-none absolute inset-0">
    <div class="story-bg-1 absolute inset-0"></div>
    <div class="story-bg-2 story-bg-2 absolute inset-0 opacity-0"></div>
    <div class="story-bg-3 story-bg-3 absolute inset-0 opacity-0"></div>
    <div class="story-bg-4 story-bg-4 absolute inset-0 opacity-0"></div>
    <div class="story-bg-5 story-bg-5 absolute inset-0 opacity-0"></div>
    <div class="story-bg-noise absolute inset-0 opacity-25"></div>
    <div class="story-bg-grid absolute inset-0 story-bg-grid opacity-0"></div>
    <div class="story-orb story-orb-a absolute"></div>
    <div class="story-orb story-orb-b absolute"></div>
    <div class="story-orb story-orb-c absolute"></div>

    <svg class="story-flow-svg absolute inset-0" viewBox="0 0 1200 560" preserveAspectRatio="none" aria-hidden="true">
      <path class="story-flow-path" d="M0,80 C220,130 280,30 430,96 C560,156 640,230 780,200 C930,168 1000,290 1200,260" />
    </svg>
  </div>

  <div class="relative z-10">
    <section class="story-phase story-phase-1 flex min-h-screen items-center">
      <div class="mx-auto w-full max-w-7xl px-6">
        <div class="story-phase-copy max-w-3xl">
          <p class="text-sm uppercase tracking-[0.24em] text-muted">Entropia</p>
          <h2 data-entropy-title data-final-text="A legtobb weboldal csak jelen van." class="mt-6 text-4xl font-bold leading-tight md:text-6xl">
            A legtobb weboldal csak jelen van.
          </h2>
          <p class="mt-6 max-w-2xl text-base leading-relaxed text-muted md:text-lg">
            Nincs benne valodi folyamat, ami fogadja, rendszerezi es tovabbviszi az erdeklodest.
          </p>
        </div>

        <div class="chaos-grid mt-10 grid gap-4 md:mt-14 md:grid-cols-2">
          <article class="chaos-card story-glass rounded-xl border border-white/10 p-5 md:ml-8 md:max-w-md">Bejovo erdeklodes elveszik</article>
          <article class="chaos-card story-glass rounded-xl border border-white/10 p-5 md:ml-auto md:mr-10 md:max-w-md">Nincs automatizalt valasz</article>
          <article class="chaos-card story-glass rounded-xl border border-white/10 p-5 md:ml-2 md:max-w-md">Nincs CRM osszekotes</article>
          <article class="chaos-card story-glass rounded-xl border border-white/10 p-5 md:ml-auto md:mr-16 md:max-w-md">Nincs meres</article>
          <article class="chaos-card story-glass rounded-xl border border-white/10 p-5 md:ml-14 md:max-w-md">Nincs utan-kovetes</article>
          <article class="chaos-card story-glass rounded-xl border border-white/10 p-5 md:ml-auto md:mr-6 md:max-w-md">Nincs folyamatfegyelem</article>
        </div>
      </div>
    </section>

    <section class="story-phase story-phase-2 flex min-h-screen items-center">
      <div class="mx-auto w-full max-w-7xl px-6">
        <div class="story-phase-copy max-w-3xl">
          <p class="text-sm uppercase tracking-[0.24em] text-muted">Disconnect</p>
          <h3 class="mt-5 text-4xl font-bold leading-tight md:text-5xl">Ez nem rendszer.<br />Ez csak jelenlet.</h3>
          <p class="mt-6 max-w-2xl text-base leading-relaxed text-muted md:text-lg">
            Az elemek leteznek, de nem beszelnek egymassal. Nincs osszefuggo adatut.
          </p>
        </div>

        <div class="relative mt-12">
          <div class="grid gap-4 md:grid-cols-3">
            <div class="broken-node story-glass rounded-xl border border-white/10 p-4">Weboldal</div>
            <div class="broken-node story-glass rounded-xl border border-white/10 p-4">Urlap</div>
            <div class="broken-node story-glass rounded-xl border border-white/10 p-4">Erdeklodo</div>
          </div>
          <svg class="pointer-events-none absolute inset-0 hidden md:block" viewBox="0 0 1000 260" preserveAspectRatio="none" aria-hidden="true">
            <path class="broken-line" d="M90,80 C220,10 320,140 420,80" />
            <path class="broken-line" d="M420,80 C540,22 640,160 760,96" />
            <path class="broken-line" d="M420,190 C560,130 640,230 810,170" />
          </svg>
        </div>
      </div>
    </section>

    <section class="story-phase story-phase-3 flex min-h-screen items-center">
      <div class="mx-auto w-full max-w-7xl px-6">
        <div class="story-phase-copy max-w-3xl">
          <p class="text-sm uppercase tracking-[0.24em] text-muted">Grid Snap</p>
          <h3 class="mt-5 text-4xl font-bold leading-tight md:text-5xl">
            Az <span class="text-primary">Aimentool</span> rendszert epit.
          </h3>
          <p class="mt-6 max-w-2xl text-base leading-relaxed text-muted md:text-lg">
            A szetesett elemek osszeallnak egy merheto, skalazhato mukodesi modellbe.
          </p>
        </div>

        <div class="sync-grid mt-12">
          <div class="sync-slot" data-sync-slot="0"></div>
          <div class="sync-slot" data-sync-slot="1"></div>
          <div class="sync-slot" data-sync-slot="2"></div>
          <div class="sync-slot" data-sync-slot="3"></div>
          <div class="sync-slot" data-sync-slot="4"></div>
          <div class="sync-slot" data-sync-slot="5"></div>
        </div>
      </div>
    </section>

    <section class="story-phase story-phase-4 min-h-screen">
      <div class="engine-pin-wrap mx-auto flex w-full max-w-7xl items-center px-6 py-20">
        <TheEngine />
      </div>
    </section>

    <section class="story-phase story-phase-5 min-h-screen py-20">
      <div class="service-pin mx-auto w-full max-w-7xl px-6">
        <div class="story-phase-copy max-w-3xl">
          <p class="text-sm uppercase tracking-[0.24em] text-muted">Modulok</p>
          <h3 class="mt-5 text-4xl font-bold leading-tight md:text-5xl">Konkret elemek, konkret eredmenyhez.</h3>
          <p class="mt-6 max-w-2xl text-base leading-relaxed text-muted md:text-lg">
            Nem igeretet adunk, hanem vegrehajthato modulokat epitunk ossze egy rendszerbe.
          </p>
        </div>

        <div class="service-track mt-10">
          <article class="service-card story-glass rounded-xl border border-white/10 p-6">
            <h4 class="text-xl font-semibold">Weboldal es Story</h4>
            <p class="mt-3 text-sm leading-relaxed text-muted">Gyors Astro alap, mobiloptimalizalt szerkezet, tiszta informacio-architektura.</p>
          </article>
          <article class="service-card story-glass rounded-xl border border-white/10 p-6">
            <h4 class="text-xl font-semibold">Lead es CRM</h4>
            <p class="mt-3 text-sm leading-relaxed text-muted">Urlapbol azonnali CRM beerkezes, statuszkezeles, visszakovetheto ugyfelut.</p>
          </article>
          <article class="service-card story-glass rounded-xl border border-white/10 p-6">
            <h4 class="text-xl font-semibold">Automatizacio</h4>
            <p class="mt-3 text-sm leading-relaxed text-muted">Automatikus email, SMS ertesites, ismetelheto es skalazhato folyamatok.</p>
          </article>
          <article class="service-card story-glass rounded-xl border border-white/10 p-6">
            <h4 class="text-xl font-semibold">Hirdetes es tartalom</h4>
            <p class="mt-3 text-sm leading-relaxed text-muted">Meta kampanykivitelezes, celcsoport-logika, utemezett posztolasi workflow.</p>
          </article>
          <article class="service-card story-glass rounded-xl border border-white/10 p-6">
            <h4 class="text-xl font-semibold">Meres es optimalizalas</h4>
            <p class="mt-3 text-sm leading-relaxed text-muted">Valos teljesitmenymeres, konverzios fokusz es folyamatos rendszerhangolas.</p>
          </article>
        </div>
      </div>
    </section>

    <section class="story-phase story-phase-6 flex min-h-screen items-center">
      <div class="mx-auto w-full max-w-7xl px-6">
        <div class="story-phase-copy max-w-3xl">
          <p class="text-sm uppercase tracking-[0.24em] text-muted">Integracio</p>
          <h3 class="mt-5 text-4xl font-bold leading-tight md:text-5xl">
            Nem csak weboldalt kapsz.<br />
            <span class="text-primary">Rendszert kapsz.</span>
          </h3>
        </div>

        <div class="integration-grid mt-12 grid gap-4 md:grid-cols-2">
          <article class="integration-card story-glass rounded-xl border border-primary/35 p-5">Kaosz helyett folyamat</article>
          <article class="integration-card story-glass rounded-xl border border-primary/35 p-5">Kezi munka helyett automatizmus</article>
          <article class="integration-card story-glass rounded-xl border border-primary/35 p-5">Elszort adatok helyett kozos rendszer</article>
          <article class="integration-card story-glass rounded-xl border border-primary/35 p-5">Jelenlet helyett merheto mukodes</article>
        </div>
      </div>
    </section>

    <section class="story-phase story-phase-7 flex min-h-screen items-center">
      <div class="mx-auto w-full max-w-7xl px-6">
        <div class="max-w-3xl">
          <p class="text-sm uppercase tracking-[0.24em] text-muted">Launch</p>
          <h3 class="mt-5 text-5xl font-bold leading-tight md:text-7xl">Epits rendszert.<br />Ne csak oldalt.</h3>
          <p class="mt-6 max-w-2xl text-base leading-relaxed text-muted md:text-lg">
            Ha a kovetkezo szint a cel, akkor olyan digitalis infrastruktura kell, ami helyetted is dolgozik.
          </p>
          <a href="#contact" class="mt-10 inline-flex rounded-md border border-primary bg-primary px-7 py-3 text-sm font-semibold text-dark transition hover:bg-transparent hover:text-primary">
            Inditsuk el
          </a>
        </div>
      </div>
    </section>
  </div>
</section>

<script type="module">
  import { createStoryAnimation } from '/src/hooks/useStoryAnimation.ts';
  let cleanup = null;

  createStoryAnimation('#story-scroll-root')
    .then((dispose) => {
      cleanup = dispose;
    })
    .catch(() => {
      cleanup = null;
    });

  window.addEventListener(
    'pagehide',
    () => {
      if (cleanup) cleanup();
    },
    { once: true }
  );
</script>
